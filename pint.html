
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login — Calculadora Científica</title>
  <style>
    body{font-family:system-ui,Segoe UI,Arial;background:#f3f4f6;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
    .card{background:#fff;padding:28px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.08);width:320px}
    h1{font-size:20px;margin:0 0 14px}
    label{display:block;font-size:13px;margin:8px 0 6px}
    input{width:100%;padding:10px;border-radius:8px;border:1px solid #e5e7eb;font-size:14px}
    button{width:100%;padding:10px;margin-top:14px;border-radius:8px;border:0;background:#0ea5a4;color:#fff;font-weight:600}
    .small{font-size:13px;margin-top:10px;text-align:center}
    .link{color:#0ea5a4;cursor:pointer}
    .error{color:#dc2626;margin-top:8px;font-size:13px}
  </style>
</head>
<body>
  <div class="card">
    <h1>Entrar — Calculadora Científica</h1>
    <form id="loginForm">
      <label for="username">Usuário</label>
      <input id="username" autocomplete="username" required />
      <label for="password">Senha</label>
      <input id="password" type="password" autocomplete="current-password" required />
      <div id="error" class="error" style="display:none"></div>
      <button type="submit">Entrar</button>
    </form>

    <div class="small">Não tem conta? <span id="registerBtn" class="link">Criar conta teste</span></div>
    <div class="small" style="margin-top:8px;color:#6b7280">Credenciais de teste: <strong>test</strong> / <strong>1234</strong></div>
  </div>

  <script>
    // Inicializa 'banco' de teste se não existir
    (function(){
      if(!localStorage.getItem('users')){
        const users = [{username:'test', password:'1234'}];
        localStorage.setItem('users', JSON.stringify(users));
      }
    })();

    const form = document.getElementById('loginForm');
    const errorEl = document.getElementById('error');
    const registerBtn = document.getElementById('registerBtn');

    form.addEventListener('submit', function(e){
      e.preventDefault();
      errorEl.style.display='none';
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value;
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const found = users.find(x => x.username === u && x.password === p);
      if(found){
        // salva sessão simples
        localStorage.setItem('currentUser', JSON.stringify({username:u}));
        // redireciona para a calculadora
        window.location.href = 'calculadora.html';
      } else {
        errorEl.innerText = 'Usuário ou senha incorretos.';
        errorEl.style.display='block';
      }
    });

    registerBtn.addEventListener('click', function(){
      const u = prompt('Escolha um nome de usuário (apenas teste):');
      if(!u) return;
      const p = prompt('Escolha uma senha:');
      if(!p) return;
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      if(users.find(x=>x.username===u)){
        alert('Nome de usuário já existe.');
        return;
      }
      users.push({username:u, password:p});
      localStorage.setItem('users', JSON.stringify(users));
      alert('Conta criada. Você pode entrar agora.');
    });
  </script>
</body>
</html>


<!-- ==================== calculadora.html ==================== -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculadora Científica</title>
  <style>
    :root{--bg:#0f172a;--panel:#0b1220}
    body{margin:0;height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#0b1220, #071025);font-family:system-ui,Segoe UI,Arial;color:#e6eef6}
    .shell{width:400px;background:var(--panel);border-radius:14px;padding:18px;box-shadow:0 12px 40px rgba(2,6,23,0.6)}
    .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .welcome{font-size:14px;color:#9fb3c6}
    .display{background:#081123;padding:14px;border-radius:10px;min-height:64px;margin-bottom:12px;display:flex;flex-direction:column;justify-content:center}
    #expr{font-size:18px;word-wrap:break-word}
    #result{font-size:20px;color:#a7f3d0}
    .kbd{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
    button.key{padding:12px;border-radius:8px;border:0;background:#0b2130;color:#e6eef6;font-weight:600;cursor:pointer}
    button.key.op{background:#064e52}
    .bottom{display:flex;justify-content:space-between;margin-top:10px}
    .hist{max-height:120px;overflow:auto;background:#07111a;padding:10px;border-radius:8px;margin-top:10px;font-size:13px}
    .smallbtn{padding:8px;border-radius:8px;border:0;background:#0ea5a4;color:#fff;cursor:pointer}
  </style>
</head>
<body>
  <div class="shell">
    <div class="top">
      <div>
        <div class="welcome" id="welcome">Olá — convidado</div>
      </div>
      <div>
        <button id="logout" class="smallbtn">Sair</button>
      </div>
    </div>

    <div class="display">
      <div id="expr">0</div>
      <div id="result"></div>
    </div>

    <div class="kbd" id="keys"></div>

    <div class="bottom">
      <div>
        <button id="clearHistory" class="smallbtn">Limpar histórico</button>
      </div>
      <div>
        <button id="copyResult" class="smallbtn">Copiar resultado</button>
      </div>
    </div>

    <div class="hist" id="history"></div>
  </div>

  <script>
    // checa sessão simples
    const current = JSON.parse(localStorage.getItem('currentUser') || 'null');
    if(!current){
      alert('Sessão não encontrada. Você será redirecionado para a página de login.');
      window.location.href = 'login.html';
    }
    document.getElementById('welcome').innerText = 'Olá — ' + current.username;
    document.getElementById('logout').addEventListener('click', ()=>{
      localStorage.removeItem('currentUser');
      window.location.href = 'login.html';
    });

    // teclas configuradas
    const keys = [
      '7','8','9','/','sin','cos',
      '4','5','6','*','tan','log',
      '1','2','3','-','ln','^',
      '0','.','(',')','sqrt','!'
    ];

    const keysDiv = document.getElementById('keys');
    keys.forEach(k => {
      const btn = document.createElement('button');
      btn.className = 'key' + (/[+\-*/^()!]/.test(k) || ['sin','cos','tan','log','ln','sqrt','!'].includes(k) ? ' op' : '');
      btn.textContent = k;
      btn.addEventListener('click', ()=>onKey(k));
      keysDiv.appendChild(btn);
    });

    // adiciona botões especiais
    const eq = document.createElement('button'); eq.className='key op'; eq.textContent='='; eq.style.gridColumn='span 2'; eq.addEventListener('click', evaluate);
    const del = document.createElement('button'); del.className='key op'; del.textContent='DEL'; del.addEventListener('click', delChar);
    const ac = document.createElement('button'); ac.className='key op'; ac.textContent='AC'; ac.addEventListener('click', clearAll);
    keysDiv.appendChild(eq); keysDiv.appendChild(del); keysDiv.appendChild(ac);

    const exprEl = document.getElementById('expr');
    const resultEl = document.getElementById('result');

    let expr = '';
    function update(){
      exprEl.textContent = expr || '0';
    }
    function onKey(k){
      if(k==='sqrt'){ expr += 'sqrt('; }
      else if(k==='!'){ expr += '!'; }
      else if(['sin','cos','tan','log','ln'].includes(k)){ expr += k + '('; }
      else if(k==='^'){ expr += '^'; }
      else expr += k;
      update();
    }
    function delChar(){ expr = expr.slice(0,-1); update(); }
    function clearAll(){ expr=''; resultEl.textContent=''; update(); }

    // avaliação segura simples
    function sanitize(s){
      // permite dígitos, operadores, parênteses, ponto, letras das funções e espaço
      if(!/^[0-9+\-*/^().,! a-zA-Z]*$/.test(s)) return null;
      return s;
    }

    function factorial(n){
      if(n<0) return NaN;
      if(n===0) return 1;
      let res=1;
      for(let i=1;i<=n;i++) res*=i;
      return res;
    }

    function evaluate(){
      const s = sanitize(expr);
      if(s===null){ resultEl.textContent='Entrada inválida'; return; }
      try{
        // substituições: '^' -> **, 'ln(' -> Math.log(, 'log(' -> Math.log10(, 'sqrt(' -> Math.sqrt(
        let t = s.replace(/\^/g,'**')
                 .replace(/\bln\(/g,'Math.log(')
                 .replace(/\blog\(/g,'Math.log10(')
                 .replace(/\bsin\(/g,'Math.sin(')
                 .replace(/\bcos\(/g,'Math.cos(')
                 .replace(/\btan\(/g,'Math.tan(')
                 .replace(/\bsqrt\(/g,'Math.sqrt(');
        // trata factorial: número! -> factorial(number)
        t = t.replace(/(\d+)\!/g, function(_,n){ return 'fac('+n+')'; });

        // cria função com Math e fac ligada
        const fn = new Function('fac', 'return ('+t+');');
        const value = fn(factorial);
        const pretty = (Number.isFinite(value) ? +value.toPrecision(12) : String(value));
        resultEl.textContent = pretty;

        // salva histórico no 'banco'
        saveHistory({user: current.username, expression: expr, result: pretty, at: new Date().toISOString()});
        loadHistory();
      } catch(e){
        resultEl.textContent = 'Erro';
      }
    }

    // histórico como "banco" de testes
    function saveHistory(entry){
      const key = 'calc_history';
      const arr = JSON.parse(localStorage.getItem(key) || '[]');
      arr.unshift(entry);
      // mantém só os 50 mais recentes
      localStorage.setItem(key, JSON.stringify(arr.slice(0,50)));
    }
    function loadHistory(){
      const key = 'calc_history';
      const arr = JSON.parse(localStorage.getItem(key) || '[]');
      const container = document.getElementById('history');
      container.innerHTML = '';
      arr.forEach(it => {
        const d = document.createElement('div');
        d.style.padding='6px 0';
        d.style.borderBottom='1px solid rgba(255,255,255,0.03)';
        d.innerHTML = '<div style="color:#9fb3c6;font-size:13px">'+it.expression+'</div><div style="color:#c7f9e6;font-weight:700">='+it.result+'</div><div style="font-size:11px;color:#6b7280">'+(new Date(it.at)).toLocaleString()+'</div>';
        container.appendChild(d);
      });
    }

    document.getElementById('clearHistory').addEventListener('click', ()=>{
      localStorage.removeItem('calc_history'); loadHistory();
    });
    document.getElementById('copyResult').addEventListener('click', ()=>{
      const txt = resultEl.textContent || exprEl.textContent;
      if(!txt) return;
      navigator.clipboard?.writeText(txt).then(()=>alert('Copiado!')).catch(()=>alert('Não foi possível copiar.'));
    });

    // carrega histórico inicial
    loadHistory();
    update();
  </script>
</body>
</html>

